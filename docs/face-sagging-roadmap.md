# 顔たるみ診断AI 開発ロードマップ

## 🎯 概要

本プロジェクトは、顔の34ランドマーク情報をもとに、
**「頬のたるみ」「フェイスラインの緩み」などを数値化・可視化**するAI診断機能を開発する。

第一段階では、精度よりも「安定性・再現性・説明可能性」を重視し、
段階的に臨床的妥当性や機能拡張を行う。

---

## 🩵 STEP 1：初期実装・安定化フェーズ（現行実装）

### 目的
まずは「撮影条件が安定した状態で再現性の高いスコアを出す」ことに集中。

### 実装内容
- **主要4指標**
  - CDI：頬下降量（目尻＋口角平均高さを基準）
  - JLA：下顎角（フェイスライン角度）
  - MCD：口角水平角
  - JWR：ジョウル幅比（参考値）
- **左右差スコア**
  - CDI_L/R, JLA_L/R から非対称スコアを算出。
- **品質管理**
  - FaceMeshの信頼度（visibility）で低信頼点を自動除外。
  - 表情検出（上下唇距離＋口角角度）で笑顔・食いしばり時は「再撮影促し」。
  - ヨー/ピッチ角（耳珠・目・鼻3点）を用いて±5°以上の傾きがあれば再撮影アラート。
- **スコア**
  - CDI・JLAを主軸とした0–100スコア（相対評価）。
  - Before / After 比較モード対応。
- **非採用（現段階）**
  - JWRを主要スコアには含めない（骨格依存性が高いため）。
  - 臨床データベース基準の年齢補正は後期対応。

---

## 🩷 STEP 2：精度向上フェーズ（アルゴリズム拡張）

### 目的
幾何的精度・頑健性・臨床的妥当性を高め、より細かい部位解析を可能にする。

### 新規実装項目
- **ランドマーク信頼度重み付け**
  - MediaPipe FaceMeshの`visibility`を参照し、低信頼点は加重平均または除外。
- **複合頬下降指標**
  - 目尻→頬中心ベクトル角
  - 鼻翼→頬中心ベクトル角  
  → 垂直距離（CDI）だけでなく、下降方向（角度）も解析。
- **マリオネットライン指標**
  - 口角→顎角の距離・角度を評価し、口元下垂スコアに反映。
- **目の下のたるみ指標**
  - EYE_BOTTOM_BOUNDARY と頬中心の距離を解析。
  - 目袋・クマ領域の変化をスコア化。
- **スコアの再設計**
  - CDI / JLA / マリオネット / 目元たるみ の複合加重スコアに再構成。
  - 各指標の単位・分布を正規化。
- **CDI_v2（基準改訂）**
  - 現行「目尻＋口角平均高さ」→「目頭〜鼻翼ベクトル」基準へ置き換え検証。

---

## 💎 STEP 3：臨床・データベース拡張フェーズ

### 目的
臨床的な信頼性を確立し、研究・業務利用に耐えるモデルへ発展させる。

### 新規実装項目
- **年齢・性別別スコア補正**
  - 収集データから年代別平均を算出し、同年代比較を可能に。
- **スコア説明表示**
  - 「このスコアはどの部位の変化に基づくか」をUI上に明示。
- **AR姿勢ガイド**
  - 顔の向きをリアルタイム検知し、ガイド枠で撮影補助。
- **3D補正・DepthMap対応（研究）**
  - ステレオカメラ／LiDAR／Depth APIで立体角度補正を検証。
- **臨床連携データ**
  - 美容外科・エステ業界との共同で平均指標データを蓄積し、信頼区間を定義。

---

## 🚫 現段階で非採用（または保留）

| 項目 | 理由 |
|------|------|
| JWR（ジョウル幅比）を主要スコアに採用 | 個人骨格差が大きく、加齢変化より骨格形状に依存。 |
| 医学的標準スコア全面導入 | 臨床データが少なく、初期段階では相対比較の方が信頼性高い。 |
| リアルタイムAR補正の即時導入 | UX的魅力はあるが、初期負荷が高いためSTEP3以降に。 |

---

## 🧠 将来構想（アプリ全体統合に向けて）

- **Before/After比較モード**（施術前後の効果測定）
- **時系列比較モード**（月次・週次の習慣効果トラッキング）
- **AIアドバイス連携**
  - 「右頬の下降傾向」「顎角が広がっています」など、自動コメント生成
- **メンタルヘルスAIとの統合**
  - 睡眠・ストレス・姿勢など他因子との関連分析

---

## ⚙️ 技術要件まとめ

| 項目 | 内容 |
|------|------|
| 検出API | Google Mediapipe FaceMesh / OpenCV Landmark / Vision API |
| 計算環境 | TypeScript + Node.js（Next.js API Route） |
| 正規化 | 両眼距離によるスケール補正＋両眼水平回転補正 |
| DB構成 | Supabase（face_sessions / compare_results） |
| 主要関数 | `normalizeLandmarks()` / `getMetrics()` / `compareMetrics()` |
| 信頼度管理 | FaceMesh visibility threshold（0.5以下は重み減） |

---

## 🪄 開発順序まとめ

| フェーズ | 実装対象 | 目的 |
|-----------|-----------|------|
| **STEP 1（現行）** | CDI / JLA / MCD + 左右差 + 再撮影ガイド | 安定化・相対比較の確立 |
| **STEP 2（精度拡張）** | ベクトル角・マリオネットライン・信頼度重み | 幾何的精度の向上 |
| **STEP 3（臨床連携）** | 年齢別スコア・AR姿勢ガイド | 医療・美容業界連携レベルへ |

---

## 📌 備考
- **UI面**：ユーザーには「Before/Afterでどこが変わったか」が直感的に分かる可視化（ベクトル線・色強調）を優先。
- **ビジネス面**：施術前後比較モードは美容クリニック・エステでの導入価値が高い。
- **アルゴリズム面**：誤差要因（照明・表情・角度）をまず最小化することが“精度向上の8割”。

---

© Market Supporter AI  
開発責任：Okuyama Teruhiko  
Version 1.0（2025年11月1日）
